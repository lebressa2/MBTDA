# =============================================================================
# üîß CONFIGURA√á√ÉO DO RUFF (Linter/Formatter Python)
# =============================================================================
#
# üìñ O QUE √â RUFF?
# Ruff √© uma ferramenta MUITO r√°pida que:
#   1. Verifica erros no c√≥digo (linting)
#   2. Formata c√≥digo automaticamente (formatting)
#   3. Organiza imports
#
# üöÄ COMO USAR?
#   ruff check src/      ‚Üí Verifica problemas
#   ruff format src/     ‚Üí Formata c√≥digo
#   ruff check --fix     ‚Üí Corrige problemas automaticamente
#
# üìö DOCUMENTA√á√ÉO: https://docs.astral.sh/ruff/
# =============================================================================

[tool.ruff]
# Vers√£o do Python alvo
target-version = "py311"

# Tamanho m√°ximo de linha (padr√£o PEP 8 = 79, mas 100 √© mais pr√°tico)
line-length = 100

# Pastas para verificar
include = ["src/**/*.py", "tests/**/*.py"]

# Pastas para ignorar
exclude = [
    ".git",
    ".venv",
    "venv",
    "__pycache__",
    "*.pyc",
]

# =============================================================================
# REGRAS DE LINTING
# =============================================================================
# Cada letra representa uma categoria de regras:
#   E = Erros de sintaxe (pycodestyle)
#   F = Erros l√≥gicos (Pyflakes)
#   W = Warnings (avisos)
#   I = Imports (isort)
#   UP = Upgrade (sugere sintaxe mais moderna)
#   B = Bugbear (bugs comuns)
#   SIM = Simplify (simplifica√ß√µes)
# =============================================================================

[tool.ruff.lint]
select = [
    "E",      # Erros de estilo (pycodestyle errors)
    "F",      # Erros l√≥gicos (Pyflakes)
    "W",      # Warnings (pycodestyle warnings)
    "I",      # Imports n√£o organizados (isort)
    "UP",     # C√≥digo desatualizado (pyupgrade)
    "B",      # Bugs comuns (flake8-bugbear)
    "SIM",    # C√≥digo que pode ser simplificado
]

# Regras para IGNORAR (n√£o reportar erro)
ignore = [
    "E501",   # Linha muito longa (preferimos line-length global)
    "B008",   # Argumento padr√£o mut√°vel em fun√ß√£o (comum em FastAPI)
]

# Permitir corre√ß√µes autom√°ticas para todas essas categorias
fixable = ["ALL"]

# =============================================================================
# REGRAS POR TIPO DE ARQUIVO
# =============================================================================

[tool.ruff.lint.per-file-ignores]
# Em arquivos de teste, √© OK ter imports n√£o usados (fixtures do pytest)
"tests/**/*.py" = ["F401", "F811"]
# Em __init__.py, √© OK ter imports n√£o usados (re-exporta√ß√£o)
"__init__.py" = ["F401"]

# =============================================================================
# ORGANIZA√á√ÉO DE IMPORTS (isort)
# =============================================================================

[tool.ruff.lint.isort]
# Agrupa imports em se√ß√µes
known-first-party = ["src"]
section-order = [
    "future",          # from __future__ import ...
    "standard-library", # import os, sys, etc.
    "third-party",     # import pydantic, langchain, etc.
    "first-party",     # import src.agent, etc. (seu c√≥digo)
    "local-folder",    # from . import algo
]

# =============================================================================
# FORMATA√á√ÉO (substitui Black)
# =============================================================================

[tool.ruff.format]
# Usa aspas duplas para strings (padr√£o Python)
quote-style = "double"

# Indenta√ß√£o com espa√ßos (n√£o tabs)
indent-style = "space"

# Mant√©m "magic trailing comma" (√∫til para diffs do git)
skip-magic-trailing-comma = false

# =============================================================================
# CONFIGURA√á√ÉO DO PYTEST
# =============================================================================

[tool.pytest.ini_options]
# Onde procurar testes
testpaths = ["tests"]

# Markers (tags) para organizar testes
markers = [
    "unit: Testes unit√°rios r√°pidos (sem APIs reais)",
    "integration: Testes com APIs reais",
    "e2e: Testes end-to-end completos",
    "slow: Testes que demoram >10 segundos",
]

# Op√ß√µes padr√£o ao rodar pytest
addopts = [
    "-v",                    # Verbose
    "--tb=short",            # Traceback curto
    "-ra",                   # Mostra resumo de todos os resultados
    "--strict-markers",      # Erro se usar marker n√£o definido
]

# Ignora warnings espec√≠ficos (menos spam no output)
filterwarnings = [
    "ignore::DeprecationWarning",
]
