# =============================================================================
# üß™ WORKFLOW DE TESTES AUTOMATIZADOS
# =============================================================================
# 
# üìñ O QUE ESSE ARQUIVO FAZ?
# Este arquivo diz ao GitHub: "Toda vez que algu√©m fizer push ou abrir um PR,
# execute esses comandos automaticamente".
#
# üîç ONDE VER OS RESULTADOS?
# No GitHub: Aba "Actions" do seu reposit√≥rio
#
# üí° DICA: Linhas come√ßando com # s√£o coment√°rios (ignoradas pelo sistema)
# =============================================================================

name: "üß™ Testes Automatizados"  # Nome que aparece no GitHub

# =============================================================================
# QUANDO ESSE WORKFLOW DEVE RODAR?
# =============================================================================
on:
  # Quando algu√©m fizer PUSH para essas branches:
  push:
    branches: 
      - main      # Branch de produ√ß√£o
      - develop   # Branch de desenvolvimento
  
  # Quando algu√©m abrir/atualizar um PULL REQUEST para essas branches:
  pull_request:
    branches: 
      - main
      - develop

# =============================================================================
# O QUE FAZER QUANDO O WORKFLOW RODAR?
# =============================================================================
jobs:
  # ---------------------------------------------------------------------------
  # JOB 1: TESTES UNIT√ÅRIOS
  # ---------------------------------------------------------------------------
  # Um "job" √© um conjunto de passos que rodam em uma m√°quina virtual.
  # Cada job roda de forma isolada (m√°quina limpa, sem nada instalado).
  # ---------------------------------------------------------------------------
  
  test:
    name: "üî¨ Rodar Testes"
    
    # Em qual sistema operacional rodar?
    # Op√ß√µes: ubuntu-latest, windows-latest, macos-latest
    runs-on: ubuntu-latest
    
    # Passos a executar (em ordem):
    steps:
      # -----------------------------------------------------------------------
      # PASSO 1: Baixar o c√≥digo do reposit√≥rio
      # -----------------------------------------------------------------------
      # Sem isso, a m√°quina virtual est√° vazia!
      # "uses" significa "use uma action pronta feita por algu√©m"
      # -----------------------------------------------------------------------
      - name: "üì• Baixar c√≥digo do reposit√≥rio"
        uses: actions/checkout@v4
      
      # -----------------------------------------------------------------------
      # PASSO 2: Instalar Python
      # -----------------------------------------------------------------------
      # A m√°quina virtual vem com Python, mas queremos uma vers√£o espec√≠fica.
      # -----------------------------------------------------------------------
      - name: "üêç Instalar Python 3.11"
        uses: actions/setup-python@v5
        with:
          python-version: "3.11"
      
      # -----------------------------------------------------------------------
      # PASSO 3: Instalar depend√™ncias do projeto
      # -----------------------------------------------------------------------
      # "run" significa "execute esse comando no terminal"
      # O "|" permite m√∫ltiplas linhas de comando
      # -----------------------------------------------------------------------
      - name: "üì¶ Instalar depend√™ncias"
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt
          pip install pytest pytest-cov
      
      # -----------------------------------------------------------------------
      # PASSO 4: Rodar os testes
      # -----------------------------------------------------------------------
      # pytest: ferramenta que roda testes em Python
      # -v: modo verbose (mostra detalhes)
      # --tb=short: traceback curto em caso de erro
      # -----------------------------------------------------------------------
      - name: "üß™ Executar testes"
        run: |
          pytest tests/ -v --tb=short
        # Se os testes falharem, o workflow falha e voc√™ √© notificado!

  # ---------------------------------------------------------------------------
  # JOB 2: VERIFICAR QUALIDADE DO C√ìDIGO (LINTING)
  # ---------------------------------------------------------------------------
  # Linting = verificar se o c√≥digo segue boas pr√°ticas
  # Exemplo: vari√°veis n√£o usadas, imports desnecess√°rios, etc.
  # ---------------------------------------------------------------------------
  
  lint:
    name: "‚ú® Verificar Qualidade do C√≥digo"
    runs-on: ubuntu-latest
    
    steps:
      - name: "üì• Baixar c√≥digo"
        uses: actions/checkout@v4
      
      - name: "üêç Instalar Python 3.11"
        uses: actions/setup-python@v5
        with:
          python-version: "3.11"
      
      - name: "üì¶ Instalar ferramentas de linting"
        run: |
          pip install ruff
      
      # -----------------------------------------------------------------------
      # Ruff: ferramenta moderna e R√ÅPIDA para verificar c√≥digo Python
      # Substitui: flake8, isort, pyupgrade, e outros
      # -----------------------------------------------------------------------
      - name: "üîç Verificar c√≥digo com Ruff"
        run: |
          ruff check src/ --output-format=github
        # --output-format=github: formata erros de forma que o GitHub entende
        # e mostra inline no c√≥digo do PR!
